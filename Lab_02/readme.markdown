# Лабораторная работа 2: Скрипт для взаимодействия с API валютного обменника

## Описание проекта

Этот проект представляет собой Python-скрипт `currency_exchange_rate.py`, который взаимодействует с API сервиса обмена валют, описанного в предоставленных файлах. Скрипт позволяет получать курс обмена одной валюты на другую за указанную дату, сохранять результаты в JSON-файлы и логировать ошибки. Проект создан в рамках лабораторной работы `lab02`.

## Как установить необходимые зависимости

Для работы скрипта требуется Python версии 3.x и библиотека `requests`. Установите зависимости, выполнив следующую команду:

```bash
pip install requests
```

Рекомендуется использовать виртуальное окружение для изоляции зависимостей:

```bash
python -m venv venv
source venv/bin/activate  # Для Unix/Mac
venv\Scripts\activate     # Для Windows
pip install requests
```

Также необходимо, чтобы сервис обмена валют был запущен локально с помощью Docker и Docker Compose, как описано в основном `readme.md` проекта:

1. Убедитесь, что Docker и Docker Compose установлены.
2. Скопируйте `sample.env` в `.env` и задайте API-ключ:

   ```bash
   cp sample.env .env
   ```

3. Запустите сервис:

   ```bash
   docker-compose up --build
   ```

Сервис будет доступен по адресу `http://localhost:8080`.

## Как запустить скрипт

Скрипт запускается из командной строки с тремя обязательными параметрами:

- `<from_currency>` — исходная валюта (например, `USD`, `EUR`, `MDL`, `RON`, `RUS`, `UAH`).
- `<to_currency>` — целевая валюта (например, `USD`, `EUR`, `MDL`, `RON`, `RUS`, `UAH`).
- `<date>` — дата в формате `YYYY-MM-DD` (в диапазоне с 2025-01-01 по 2025-09-15).

Пример команды:

```bash
python lab02/currency_exchange_rate.py USD EUR 2025-01-01
```

### Тестовые примеры запуска

Для тестирования скрипта используйте следующие команды (покрывающие диапазон дат с равными интервалами):

1. Курс USD к EUR на 2025-01-01:
   ```bash
   python lab02/currency_exchange_rate.py USD EUR 2025-01-01
   ```

2. Курс MDL к RON на 2025-03-15:
   ```bash
   python lab02/currency_exchange_rate.py MDL RON 2025-03-15
   ```

3. Курс EUR к RUS на 2025-05-01:
   ```bash
   python lab02/currency_exchange_rate.py EUR RUS 2025-05-01
   ```

4. Курс USD к UAH на 2025-07-01:
   ```bash
   python lab02/currency_exchange_rate.py USD UAH 2025-07-01
   ```

5. Курс RON к MDL на 2025-09-15:
   ```bash
   python lab02/currency_exchange_rate.py RON MDL 2025-09-15
   ```

### Результаты выполнения

- **Успешное выполнение**: Результаты запросов сохраняются в директории `data` в файлах с именами вида `<from>_<to>_<date>.json`. Например, `data/USD_EUR_2025-01-01.json`. В консоль выводится сообщение о сохранении файла.
- **Ошибки**: Ошибки (например, неверные параметры, недоступный API, неизвестные валюты) выводятся в консоль и записываются в файл `error.log` в корне проекта.

## Структура скрипта

Скрипт `currency_exchange_rate.py` организован следующим образом:

- **Импорты**:
  - `requests` — для выполнения HTTP-запросов к API.
  - `json` — для работы с JSON-данными.
  - `os` — для работы с файловой системой (создание директории `data`).
  - `sys` — для обработки аргументов командной строки.
  - `logging` — для записи ошибок в `error.log`.
  - `re` — для валидации формата даты.
  - `datetime` — для проверки диапазона дат.

- **Настройка логирования**:
  - Логи ошибок сохраняются в файл `error.log` с указанием времени, уровня и сообщения об ошибке.

- **Функция `main()`**:
  - **Валидация аргументов**: Проверяет наличие трех аргументов (`from_currency`, `to_currency`, `date`).
  - **Валидация даты**: Проверяет формат даты (`YYYY-MM-DD`) и её нахождение в диапазоне (2025-01-01 — 2025-09-15).
  - **Запрос к API**: Выполняет POST-запрос к `http://localhost:8080/` с параметрами `from`, `to`, `date` и API-ключом из `sample.env`.
  - **Обработка ответа**: 
    - Если API возвращает ошибку, она выводится в консоль и логируется.
    - Если запрос успешен, создаётся директория `data` (если не существует), и данные сохраняются в JSON-файл.
  - **Обработка исключений**: Обрабатываются HTTP-ошибки, ошибки парсинга JSON и другие исключения с логированием.

- **Запуск**: Функция `main()` вызывается при запуске скрипта напрямую (`if __name__ == "__main__":`).

## Дополнительные замечания

- Скрипт использует API-ключ `EXAMPLE_API_KEY` из файла `sample.env`. Убедитесь, что он совпадает с ключом в `.env`.
- Данные в `data.json` покрывают период с 2025-01-01 по 2025-09-15. Запросы за пределами этого диапазона вызовут ошибку.
- Скрипт надёжен и обрабатывает различные ошибки, включая неверные валюты, недоступный API и некорректные параметры.